<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Recorder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .record-btn {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: #ff4757;
            border: 6px solid white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 40px;
            transition: all 0.2s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .record-btn:active {
            transform: scale(0.95);
        }

        .record-btn::before {
            content: '';
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
        }

        .timeline {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .date-group {
            margin-bottom: 25px;
        }

        .date-group:last-child {
            margin-bottom: 0;
        }

        .date-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f1f2f6;
        }

        .date-title {
            font-weight: 600;
            color: #2f3542;
            font-size: 1.1em;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #5568d3;
        }

        .copy-btn:active {
            background: #4c5fc7;
        }

        .time-list {
            list-style: none;
            padding-left: 0;
        }

        .time-item {
            padding: 10px 15px;
            background: #f8f9fa;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 1.1em;
            color: #2f3542;
            font-weight: 500;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .time-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .ml-value {
            color: #667eea;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
            min-width: 60px;
        }

        .ml-value:hover {
            background: #e8eaf6;
        }

        .ml-value.empty {
            color: #95a5a6;
            font-style: italic;
        }

        .time-item:last-child {
            margin-bottom: 0;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .delete-btn:hover {
            background: #ee5a6f;
        }

        .delete-btn:active {
            background: #e84258;
        }

        .empty-state {
            text-align: center;
            color: #95a5a6;
            padding: 40px 20px;
            font-style: italic;
        }

        .copied-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .copied-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Time Recorder</h1>
        
        <button class="record-btn" id="recordBtn"></button>
        
        <div class="timeline" id="timeline">
            <div class="empty-state">Press the record button to start tracking times</div>
        </div>
    </div>

    <div class="copied-notification" id="notification">Copied to clipboard!</div>

    <script>
        let records = {};
        
        function saveToStorage() {
            const data = JSON.stringify(records);
            try {
                localStorage.setItem('timeRecords', data);
            } catch (e) {
                console.error('Failed to save to storage:', e);
            }
        }
        
        function loadFromStorage() {
            try {
                const data = localStorage.getItem('timeRecords');
                if (data) {
                    const parsed = JSON.parse(data);
                    // Convert date strings back to Date objects
                    Object.keys(parsed).forEach(key => {
                        parsed[key].date = new Date(parsed[key].date);
                    });
                    records = parsed;
                    renderTimeline();
                }
            } catch (e) {
                console.error('Failed to load from storage:', e);
            }
        }
        
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        function formatDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        function getDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }
        
        function recordTime() {
            const now = new Date();
            const dateKey = getDateKey(now);
            const timeStr = formatTime(now);
            
            if (!records[dateKey]) {
                records[dateKey] = {
                    date: new Date(now.getFullYear(), now.getMonth(), now.getDate()),
                    times: []
                };
            }
            
            records[dateKey].times.push({
                time: timeStr,
                ml: null
            });
            saveToStorage();
            renderTimeline();
        }
        
        function editMl(dateKey, index) {
            const currentValue = records[dateKey].times[index].ml;
            const newValue = prompt('Enter volume in ml:', currentValue || '');
            
            if (newValue !== null) {
                const numValue = parseFloat(newValue);
                if (!isNaN(numValue) && numValue > 0) {
                    records[dateKey].times[index].ml = numValue;
                    saveToStorage();
                    renderTimeline();
                } else if (newValue === '') {
                    records[dateKey].times[index].ml = null;
                    saveToStorage();
                    renderTimeline();
                } else {
                    alert('Please enter a positive number');
                }
            }
        }
        
        function deleteTime(dateKey, index) {
            if (confirm('Are you sure you want to delete this time entry?')) {
                records[dateKey].times.splice(index, 1);
                
                if (records[dateKey].times.length === 0) {
                    delete records[dateKey];
                }
                
                saveToStorage();
                renderTimeline();
            }
        }
        
        async function copyToClipboard(dateKey) {
            const dateStr = formatDate(records[dateKey].date);
            const times = records[dateKey].times.map(entry => {
                if (entry.ml) {
                    return `${entry.time} ${entry.ml} ml`;
                }
                return entry.time;
            }).join('\n');
            const plainText = `${dateStr}\n${times}`;
            
            const htmlTimes = records[dateKey].times.map(entry => {
                if (entry.ml) {
                    return `${entry.time} ${entry.ml} ml`;
                }
                return entry.time;
            }).join('<br>');
            const htmlText = `<b>${dateStr}</b><br>${htmlTimes}`;
            
            try {
                await navigator.clipboard.write([
                    new ClipboardItem({
                        'text/html': new Blob([htmlText], { type: 'text/html' }),
                        'text/plain': new Blob([plainText], { type: 'text/plain' })
                    })
                ]);
                showNotification();
            } catch (err) {
                await navigator.clipboard.writeText(plainText);
                showNotification();
            }
        }
        
        function showNotification() {
            const notification = document.getElementById('notification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }
        
        function renderTimeline() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '';
            
            if (Object.keys(records).length === 0) {
                timeline.innerHTML = '<div class="empty-state">Press the record button to start tracking times</div>';
                return;
            }
            
            const sortedKeys = Object.keys(records).sort().reverse();
            
            sortedKeys.forEach(dateKey => {
                const record = records[dateKey];
                
                const dateGroup = document.createElement('div');
                dateGroup.className = 'date-group';
                
                const dateHeader = document.createElement('div');
                dateHeader.className = 'date-header';
                
                const dateTitle = document.createElement('div');
                dateTitle.className = 'date-title';
                dateTitle.textContent = formatDate(record.date);
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'Copy';
                copyBtn.onclick = function() { copyToClipboard(dateKey); };
                
                dateHeader.appendChild(dateTitle);
                dateHeader.appendChild(copyBtn);
                dateGroup.appendChild(dateHeader);
                
                const timeList = document.createElement('ul');
                timeList.className = 'time-list';
                
                record.times.forEach((entry, index) => {
                    const timeItem = document.createElement('li');
                    timeItem.className = 'time-item';
                    
                    const timeContent = document.createElement('div');
                    timeContent.className = 'time-content';
                    
                    const timeSpan = document.createElement('span');
                    timeSpan.textContent = entry.time;
                    
                    const mlSpan = document.createElement('span');
                    mlSpan.className = 'ml-value' + (entry.ml ? '' : ' empty');
                    mlSpan.textContent = entry.ml ? `${entry.ml} ml` : 'Add ml';
                    mlSpan.onclick = function() { editMl(dateKey, index); };
                    
                    timeContent.appendChild(timeSpan);
                    timeContent.appendChild(mlSpan);
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'Ã—';
                    deleteBtn.onclick = function() { deleteTime(dateKey, index); };
                    
                    timeItem.appendChild(timeContent);
                    timeItem.appendChild(deleteBtn);
                    timeList.appendChild(timeItem);
                });
                
                dateGroup.appendChild(timeList);
                timeline.appendChild(dateGroup);
            });
        }
        
        document.getElementById('recordBtn').addEventListener('click', recordTime);
        
        // Load data when page loads
        loadFromStorage();
    </script>
</body>
</html>